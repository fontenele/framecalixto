<script src=".calixto/scripts/Bs_TabSet.class.js"  type="text/javascript" language="javascript"></script>
<div class="container0">
	<div class="a"></div>
	<div class="b"></div>
	<div class="c"></div>
	<div class="d"></div>
	<div class="e"></div>
	<div class="f"></div>
	<div class="g"></div>
	<div class="h"></div>
	<h1 class="titulo">Definições</h1>
	<div class="texto">
		<p>«$textoAjudaDefinicao»</p>
		<div class="container0" id='camada'>
			<div class="a"></div>
			<div class="b"></div>
			<div class="c"></div>
			<div class="d"></div>
			<div class="e"></div>
			<div class="f"></div>
			<div class="g"></div>
			<div class="h"></div>
			<h1 class="titulo">Entidade</h1>
			<div class="texto">
				<table summary="text" >
					<tr>
						<td>Nome da entidade:</td>
						<td>«$entidade»</td>
					</tr>
					<tr>
						<td><a href='javascript:adicionar();' accesskey='a' title='(Alt + A)'>Adicionar nova propriedade</a></td>
					</tr>
				</table>
				<div id="tabset">
					<div id="tabset_tabs"></div>
					<div class="tabsetContentdiv" id="tabset_content" style="overflow: inherit;">
						<div id="definicaoEntidade" style="width:100%; overflow: inherit">
							<table summary="text" class="tabela1"  id="en_campos">
								<tr>
									<th title="O nome da característica da entidade">Nome da Propriedade</th>
									<th title="A abreviação da característica da entidade">Nome abreviado</th>
									<th title="A descrição da característica da entidade">Descrição</th>
								</tr>
							</table>
						</div>
						<div id="definicaoNegocio" style="width:100%; overflow: inherit">
							<table summary="text" class="tabela1"  id="ng_campos">
								<tr>
									<th title="O nome da propriedade da entidade">Propriedade</th>
									<th title="O nome da propriedade na camada de negócio">Propriedade de Negócio</th>
									<th title="O tamanho em caracteres da propriedade">Tamanho</th>
									<th title="O tipo de dado da propriedade">Tipo</th>
									<th title="Chave primária">PK</th>
									<th title="Não Nulo">NN</th>
									<th title="Chave única">UK</th>
									<th title="Chave extrangeira">FK</th>
									<th title="Domínio,  Ex.de preechimento: [1,Sim][2,Não]">Dominio</th>
									<th title="Classe de negócio assosiativa">Classe Associativa</th>
									<th title="Método de leitura utilizado pela classe de negócio assosiativa">Método de leitura</th>
								</tr>
							</table>
						</div>
						<div id="definicaoPersistente" style="width:100%; overflow: inherit">
							«$recriarBase» Recriar Base de Dados
							<table summary="text" class="tabela1"  id="bd_campos">
								<tr>
									<th title="O nome da propriedade da entidade">Indice</th>
									<th title="O nome do campo na tabela do banco">Campo da tabela</th>
									<th title="A prioridade de ordenação do campo na tabela do banco">Ordenação</th>
									<th title="O tipo de ordenação do campo">Decrescente</th>
									<th title="Caso chave extrangeira identifique o nome da tabela de referência ">Referencia a tabela</th>
									<th title="Caso chave extrangeira identifique o nome do campo de referência ">Referencia ao campo</th>
								</tr>
							</table>
						</div>
						<div id="definicaoVisualizacao" style="width:100%; overflow: inherit">
							<table summary="text" class="tabela1"  id="vi_campos">
								<tr>
									<th title="O nome da propriedade da entidade">Indice</th>
									<th title="Definição do componente de apresentação da propriedade">Componente</th>
									<th title="A ordem na listagem de apresentação">Ordem na listagem</th>
									<th title="A ordem na apresentação descritiva Ex: '001 - Campo01 - Campo02'">Ordem na descrição</th>
									<th title="A largura da coluna na listagem de apresentação (em %)">Largura</th>
									<th title="Se o campo será apresentado como um link para a edição">Link na listagem</th>
								</tr>
							</table>
						</div>
						<div id="definicaoArquivos" style="width:100%; overflow: inherit">
							<table summary="text" class="tabela1" id="arquivos">
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript" language="javascript">
var indice = 0;
var d = document.formulario;
function validar(){
	if(!d.entidade.value){
		alert('O nome da entidade não foi definido !');
		return;
	}
	/*
	var chavePK = false;
	}
	for(i in d.elements){
		componente = d.elements[i];
		if(!chavePK && componente.name.substr() == '' && ) {
			if(componente.checked) chavePK = true;
			return;
		}
		if(componente.name.substr(0,8) == 'en_nome['){
			if(campoVazio(componente,'O campo [Nome da Propriedade] é obrigatório!')) return;
			return;
		}
		if(componente.name.substr(0,8) == 'ng_nome['){
			if(campoVazio(componente,'O campo [Propriedade de Negócio] é obrigatório!')) return;
			return;
		}
		if(componente.name.substr(0,8) == 'bd_campo'){
			if(campoVazio(componente,'O campo [Campo da tabela] é obrigatório!')) return;
			return;
		}
	}
	if(!chavePK) {
		alert('Não foi definida a chave primária ou única da entidade!');
		return;
	}
	*/
	d.submit();
}
function campoVazio(componente,texto){
	if(!componente.value){
		alert(texto);
		return true;
	}else{
		return false;
	}
}
function $(elementId){
	return document.getElementById(elementId);
}
function ini(tipo){return document.createElement(tipo);}
function set(componente,atributo,valor){componente.setAttribute(atributo,valor);}
function rem(componente){componente.parentNode.removeChild(componente);}
function criarAbas(){
	t = new Bs_TabSet('tabset');
	t.addTab('Entidade',	$('definicaoEntidade'));
	t.addTab('Negócio',		$('definicaoNegocio'));
	t.addTab('Persistente',	$('definicaoPersistente'));
	t.addTab('Visualização',$('definicaoVisualizacao'));
	t.addTab('Arquivos',	$('definicaoArquivos'));
	t.draw();
}
function novoInput(nome){
	e = document.createElement('input');
	set(e,'name',nome);
	set(e,'id',nome);
	set(e,'type','text');
	set(e,'tabindex','1');
	return e;
}
function novoSelect(nome){
	e = document.createElement('select');
	set(e,'name',nome);
	set(e,'id',nome);
	set(e,'tabindex','1');
	return e;
}
function novoOption(componente, valor, texto){
	opcao = ini('option');
	opcao.innerHTML = texto;
	set(opcao,'value',valor);
	componente.appendChild(opcao);
}
function alterarPropriedade(componente, values){
	var colunaNegocio = $('indice_ng_' + componente.name);
	colunaNegocio.innerHTML = componente.value;
	var colunaNegocio = $('indice_bd_' + componente.name);
	colunaNegocio.innerHTML = componente.value;
	var colunaNegocio = $('indice_vi_' + componente.name);
	colunaNegocio.innerHTML = componente.value;
	if(values) sugerirNomePersistente(componente);
	if(values) sugerirNomeNegocio(componente);
}
function sugerirNomePersistente(componente){
	var arNome = componente.value.toLowerCase().split(' ');
	var nome = '';
	for(i in arNome){
		nome += '_' + arNome[i]
	}
	campo = $('bd_campo' + componente.name.substr(7,componente.name.length));
	campo.value = d.entidade.value.substr(0,4) + '_' + nome.substr(1,nome.length);
}
function sugerirNomeNegocio(componente){
	var arNome = componente.value.toLowerCase().split(' ');
	var nome = '';
	for(i in arNome){
		if(i > 0){
			ucfirst = arNome[i].charAt(0).toUpperCase();
		}else{
			ucfirst = arNome[i].charAt(0);
		}
		nome += ucfirst + arNome[i].substr(1,arNome[i].length);
	}
	campo = $('ng_nome' + componente.name.substr(7,componente.name.length));
	campo.value = nome;
}
function alterarFK(componente){
	var item = componente.name.substr(5,componente.name.length);
	tabela	= $('bd_referencia_tabela' + item);
	campo	= $('bd_referencia_campo' + item);
	classe	= $('ng_associativa' + item);
	metodo	= $('ng_metodo' + item);
	if(componente.checked){
		tabela.setAttribute('type','text');
		campo.setAttribute('type','text');
		classe.setAttribute('type','text');
		metodo.setAttribute('type','text');
	}else{
		tabela.setAttribute('type','hidden');
		campo.setAttribute('type','hidden');
		classe.setAttribute('type','hidden');
		metodo.setAttribute('type','hidden');
	}
}
function alterarPK(componente){
	tipoDado = $('ng_tipo[' + componente.value + ']');
	tipoDado.value = 'numerico';
}
function removerAtributo(atributo){
	rem($('en_linha_' + atributo));
	rem($('ng_linha_' + atributo));
	rem($('bd_linha_' + atributo));
	rem($('vi_linha_' + atributo));
}
function adicionar(){
	try{
		// ENTIDADE
		var en_campos = $('en_campos');
			linha = ini('tr');
			set(linha,'id','en_linha_' + indice);
			// Nome
			col = ini('td');
			nome = novoInput('en_nome[' + indice + ']');
			set(nome,'onchange','javascript:alterarPropriedade(this,true);');
			col.appendChild(nome);
			linha.appendChild(col);
			// Abreviação
			col = ini('td');
			col.appendChild(novoInput('en_abreviacao[' + indice + ']'));
			linha.appendChild(col);
			// Descrição
			col = ini('td');
			col.appendChild(novoInput('en_descricao[' + indice + ']'));
			linha.appendChild(col);
			// Descrição
			col = ini('td');
			link = ini('a');
			set(link,'href','javascript:removerAtributo(' + indice + ')');
			link.innerHTML = 'remover';
			col.appendChild(link);
			linha.appendChild(col);
		en_campos.appendChild(linha);
		// NEGOCIO
		var ng_campos = $('ng_campos');
			linha = ini('tr');
			set(linha,'id','ng_linha_' + indice);
			// indice
			col = ini('td');
			set(col,'id','indice_ng_en_nome[' + indice + ']');
			linha.appendChild(col);
			// nome
			col = ini('td');
			col.appendChild(novoInput('ng_nome[' + indice + ']'));
			linha.appendChild(col);
			// tamanho
			col = ini('td');
			input = novoInput('ng_tamanho[' + indice + ']');
			input.setAttribute('size','4');
			col.appendChild(input);
			linha.appendChild(col);
			// tipo de dado
			col = ini('td');
			select = novoSelect('ng_tipo[' + indice + ']');
			novoOption(select,'texto','texto');
			novoOption(select,'numerico','numerico');
			novoOption(select,'data','data');
			novoOption(select,'tdocumentopessoal','TDocumento');
			novoOption(select,'tcep','CEP');
			novoOption(select,'ttelefone','TTelefone');
			novoOption(select,'tnumerico','TNumerico');
			novoOption(select,'tmoeda','TMoeda');
			col.appendChild(select);
			linha.appendChild(col);
			// chave primaria
			col = ini('td');
			col.setAttribute('align','center');
			radio = novoInput('ng_chave_pk');
			radio.setAttribute('id','ng_chave_pk[' + indice + ']');
			radio.setAttribute('type','radio');
			radio.setAttribute('value',indice);
			radio.setAttribute('onchange','javascript:alterarPK(this);');
			col.appendChild(radio);
			linha.appendChild(col);
			// nulável
			col = ini('td');
			col.setAttribute('align','center');
			check = novoInput('ng_nn[' + indice + ']');
			check.setAttribute('type','checkbox');
			check.setAttribute('value',indice);
			col.appendChild(check);
			linha.appendChild(col);
			// chave única
			col = ini('td');
			col.setAttribute('align','center');
			check = novoInput('ng_uk[' + indice + ']');
			check.setAttribute('type','checkbox');
			check.setAttribute('value',indice);
			col.appendChild(check);
			linha.appendChild(col);
			// chave extrangeira
			col = ini('td');
			col.setAttribute('align','center');
			check = novoInput('ng_fk[' + indice + ']');
			check.setAttribute('type','checkbox');
			check.setAttribute('value',indice);
			check.setAttribute('onchange','javascript:alterarFK(this);');
			col.appendChild(check);
			linha.appendChild(col);
			// domínio
			col = ini('td');
			input = novoInput('ng_dominio[' + indice + ']');
			input.setAttribute('size','30');
			col.appendChild(input);
			linha.appendChild(col);
			// classe associativa
			col = ini('td');
			input = novoInput('ng_associativa[' + indice + ']');
			input.setAttribute('type','hidden');
			col.appendChild(input);
			linha.appendChild(col);
			// metodo da classe associativa
			col = ini('td');
			input = novoInput('ng_metodo[' + indice + ']');
			input.setAttribute('type','hidden');
			col.appendChild(input);
			linha.appendChild(col);
		ng_campos.appendChild(linha);
		// PERSISTENTE
		var bd_campos = $('bd_campos');
			linha = ini('tr');
			set(linha,'id','bd_linha_' + indice);
			// indice
			col = ini('td');
			set(col,'id','indice_bd_en_nome[' + indice + ']');
			linha.appendChild(col);
			// campo
			col = ini('td');
			col.appendChild(novoInput('bd_campo[' + indice + ']'));
			linha.appendChild(col);
			// prioridade de ordenação
			col = ini('td');
			input = novoInput('bd_ordem[' + indice + ']');
			input.setAttribute('size','6');
			col.appendChild(input);
			linha.appendChild(col);
			// tipo de ordenação
			col = ini('td');
			col.setAttribute('align','center');
			check = novoInput('bd_tipo_ordem[' + indice + ']');
			check.setAttribute('type','checkbox');
			check.setAttribute('value',indice);
			col.appendChild(check);
			linha.appendChild(col);
			// referencia tabela
			col = ini('td');
			input = novoInput('bd_referencia_tabela[' + indice + ']');
			input.setAttribute('type','hidden');
			col.appendChild(input);
			linha.appendChild(col);
			// referencia campo
			col = ini('td');
			input = novoInput('bd_referencia_campo[' + indice + ']');
			input.setAttribute('type','hidden');
			col.appendChild(input);
			linha.appendChild(col);
		bd_campos.appendChild(linha);
		// VISUALIZACAO
		var vi_campos = $('vi_campos');
			linha = ini('tr');
			set(linha,'id','vi_linha_' + indice);
			// indice
			col = ini('td');
			set(col,'id','indice_vi_en_nome[' + indice + ']');
			linha.appendChild(col);
			// componente de apresentação
			col = ini('td');
			select = novoSelect('vi_componente[' + indice + ']');
			novoOption(select,'oculto','Componente oculto');
			novoOption(select,'caixa de entrada','Caixa de Entrada');
			novoOption(select,'caixa de combinacao','Caixa de Combinação');
			novoOption(select,'caixa de selecao','Caixa de Seleção');
			novoOption(select,'palavra chave','Palavra Chave');
			novoOption(select,'marcador','Marcador');
			novoOption(select,'seletor','Seletor');
			novoOption(select,'data','Campo Data');
			novoOption(select,'hora','Campo Hora');
			novoOption(select,'data e hora','Campo Data e Hora');
			novoOption(select,'caixa de texto','Caixa de Texto');
			novoOption(select,'telefone','Telefone: (99)9999-9999 ');
			novoOption(select,'cep','CEP: 99.999-999');
			novoOption(select,'documento pessoal','Documento: 99.999.999-99');
			novoOption(select,'numerico','Número: 99.999.999,99');
			novoOption(select,'moeda','Moeda: R$ 99.999.999,99');
			novoOption(select,'moeda','Moeda: R$ 99.999.999,99');
	
			col.appendChild(select);
			linha.appendChild(col);
			// ordem
			col = ini('td');
			input = novoInput('vi_ordem[' + indice + ']');
			input.setAttribute('size','4');
			col.appendChild(input);
			linha.appendChild(col);
			// ordem para descrição
			col = ini('td');
			input = novoInput('vi_ordemDescritivo[' + indice + ']');
			input.setAttribute('size','4');
			col.appendChild(input);
			linha.appendChild(col);
			// largura
			col = ini('td');
			input = novoInput('vi_largura[' + indice + ']');
			input.setAttribute('size','4');
			col.appendChild(input);
			linha.appendChild(col);
			// nulável
			col = ini('td');
			col.setAttribute('align','center');
			check = novoInput('vi_link[' + indice + ']');
			check.setAttribute('type','checkbox');
			check.setAttribute('value',indice);
			col.appendChild(check);
			linha.appendChild(col);
		vi_campos.appendChild(linha);
		indice++;
	}
	catch(e){
		alert(e);
	}
}
function montarLinhaArquivo(marcado, arquivo){
	linha = ini('tr');
		col = ini('td');
		chk = novoInput('arquivo[' + arquivo + ']');
		set(chk,'type','checkbox');
		if(marcado) set(chk,'checked',true);
		col.appendChild(chk);
	linha.appendChild(col);
		col = ini('td');
		col.innerHTML = arquivo ;
	linha.appendChild(col);
	return linha;
}
function definirArquivosEntidade(marcado){
	var arNome = d.entidade.value.toLowerCase().split(' ');
	var nome = '';
	for(i in arNome){
		if(i > 0){
			ucfirst = arNome[i].charAt(0).toUpperCase();
		}else{
			ucfirst = arNome[i].charAt(0);
		}
		nome += ucfirst + arNome[i].substr(1,arNome[i].length);
	}
	nomeClasse = nome.charAt(0).toUpperCase() + nome.substr(1,nome.length);
	// Arquivos
	var arquivos = $('arquivos');
	arquivos.innerHTML = '';
		// Cabeçalho
		linha = ini('tr');
			col = ini('th');
			set(col,'title','Selecione o arquivo para salvá-lo');
		linha.appendChild(col);
			col = ini('th');
			set(col,'title','Caminho do arquivo');
			col.innerHTML = 'Arquivo';
		linha.appendChild(col);
	arquivos.appendChild(linha);
	arquivos.appendChild(montarLinhaArquivo(marcado, nome + '/classes/C' + nomeClasse + '_excluir.php'));
	arquivos.appendChild(montarLinhaArquivo(marcado, nome + '/classes/C' + nomeClasse + '_gravar.php'));
	arquivos.appendChild(montarLinhaArquivo(marcado, nome + '/classes/C' + nomeClasse + '_mudarPagina.php'));
	arquivos.appendChild(montarLinhaArquivo(marcado, nome + '/classes/C' + nomeClasse + '_pesquisar.php'));
	arquivos.appendChild(montarLinhaArquivo(marcado, nome + '/classes/C' + nomeClasse + '_verEdicao.php'));
	arquivos.appendChild(montarLinhaArquivo(marcado, nome + '/classes/C' + nomeClasse + '_verPesquisa.php'));
	arquivos.appendChild(montarLinhaArquivo(marcado, nome + '/classes/I' + nomeClasse + '.php'));
	arquivos.appendChild(montarLinhaArquivo(marcado, nome + '/classes/N' + nomeClasse + '.php'));
	arquivos.appendChild(montarLinhaArquivo(marcado, nome + '/classes/P' + nomeClasse + '.mysql.php'));
	arquivos.appendChild(montarLinhaArquivo(marcado, nome + '/classes/P' + nomeClasse + '.postgres.php'));
	arquivos.appendChild(montarLinhaArquivo(marcado, nome + '/xml/entidade.xml'));
	arquivos.appendChild(montarLinhaArquivo(marcado, nome + '/xml/pt_BR.xml'));
	arquivos.appendChild(montarLinhaArquivo(marcado, nome + '/html/C' + nomeClasse + '_verEdicao.html'));
	arquivos.appendChild(montarLinhaArquivo(marcado, nome + '/html/C' + nomeClasse + '_verPesquisa.html'));
}
function preecherTela(definicao){
	try{
		document.formulario.entidade.value = definicao.inter.nome;
		for(i in definicao.entidade){
			adicionar();
			valores = definicao.entidade[i];
			$('en_nome[' + i + ']'			).value = valores.inter.nome;
			$('en_abreviacao[' + i + ']'	).value = valores.inter.abreviacao;
			$('en_descricao[' + i + ']'		).value = valores.inter.descricao;
			$('ng_nome[' + i + ']'			).value = valores.negocio.propriedade;
			$('ng_tamanho[' + i + ']'		).value = valores.persistente.tamanho;
			$('ng_tipo[' + i + ']'			).value = valores.persistente.tipo;
			$('ng_nn[' + i + ']'			).checked = (valores.negocio.obrigatorio) ? true : false;
			$('ng_dominio[' + i + ']'		).value = valores.inter.dominio;
			if(valores.negocio.classeAssociativa){
				var fk = $('ng_fk[' + i + ']');
				fk.checked =  true;
				$('ng_associativa[' + i + ']'	).value = valores.negocio.classeAssociativa;
				$('ng_metodo[' + i + ']'		).value = valores.negocio.metodoLeitura;
				alterarFK(fk);
			}
			$('bd_campo[' + i + ']').value = valores.negocio.campo;
			$('bd_ordem[' + i + ']').value = valores.persistente.ordem;
			$('bd_tipo_ordem[' + i + ']').checked = valores.persistente.tipoOrdem;
			if(valores.persistente.chaveEstrangeira){
				$('bd_referencia_tabela[' + i + ']').value = valores.persistente.chaveEstrangeira.tabela;
				$('bd_referencia_campo[' + i + ']').value = valores.persistente.chaveEstrangeira.campo;
			}
			$('vi_componente[' + i + ']'		).value = valores.controle.componente;
			$('vi_ordemDescritivo[' + i + ']'			).value = valores.negocio.descritivo;
			if(valores.controle.listagem){
				$('vi_ordem[' + i + ']'			).value = valores.controle.ordem;
				$('vi_link[' + i + ']'			).checked = (valores.controle.hyperlink == 'sim');
				$('vi_largura[' + i + ']'		).value = LimpaNumero(valores.controle.largura);
			}
			if(valores.negocio.campo == definicao.bd.chavePrimaria){
				$('ng_chave_pk[' + i + ']').checked = true;
			}
			alterarPropriedade($('en_nome[' + i + ']'			),false);
		}
	}
	catch(e){
		alert(e);
	}
}
criarAbas();
var definicao = eval('«$dados»');
if(definicao){
	preecherTela(definicao[0]);
	definirArquivosEntidade(true);
}
</script>